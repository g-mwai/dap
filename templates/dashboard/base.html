{% load static%}

<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <!-- Google Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css'%}">
    <link rel="stylesheet" href="{% static 'css/bootstrap-grid.min.css'%}">
    <link rel="stylesheet" crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" >
    <!-- <link rel="stylesheet" href="{% static 'plugins/emojimart/emojimart.css' %}"> -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>

    <link rel="stylesheet" href="{% static 'css/dashboard.css'%}">

  
    <title>Soconey Admin</title>

  </head>
  
  <body>
   

  <div class="wrapper">
    <div class="sidebar bg-dark" data-color="" >
        <!--
    Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

    Tip 2: you can also add an image using data-image tag
-->
        <div class="sidebar-wrapper">
            <div class="logo mt-3 ml-3">
           
            </div>
           
            <ul class="nav mt-3">
                <li class="nav-item ">
                    <a class="nav-link" href="{% url 'home'%}">
                        <i class="fa-solid fa-home"></i>
                        <p>Community</p>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="{% url 'dashboard' %}">
                        <i class="fa-solid fa-gauge"></i>
                        <p>Dashboard</p>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="{% url 'docs' %}">
                        <i class="fa-solid fa-file"></i>
                        <p>Documents</p>
                    </a>
                </li>

                <li class="nav-item ">
                    <a class="nav-link" href="{% url 'landing' %}">
                        <i class="fa-solid fa-shop"></i>
                        <p>shop</p>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" data-toggle="collapse" href="#formsExamples">
                        <i class="fa-solid fa-circle-radiation"></i>
                        <p>
                            Moderation
                            <b class="caret"></b>
                        </p>
                    </a>
                    <div class="collapse " id="formsExamples">
                        <ul class="nav">
                            <li class="nav-item ">
                                <a class="nav-link" href="./forms/regular.html">
                                    <span class="sidebar-mini">Rp</span>
                                    <span class="sidebar-normal">Rerported Posts</span>
                                </a>
                            </li>
                            <li class="nav-item ">
                                <a class="nav-link" href="./forms/extended.html">
                                    <span class="sidebar-mini">Rg</span>
                                    <span class="sidebar-normal">Reported Gigs</span>
                                </a>
                            </li>
                            <li class="nav-item ">
                                <a class="nav-link" href="./forms/validation.html">
                                    <span class="sidebar-mini">R</span>
                                    <span class="sidebar-normal">Reporters</span>
                                </a>
                            </li>
                     
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="collapse" href="#tablesExamples">
                        <i class="fa-solid fa-grip-vertical"></i>
                        <p>
                            Apps
                            <b class="caret"></b>
                        </p>
                    </a>
                    <div class="collapse " id="tablesExamples">
                        <ul class="nav">
                            <li class="nav-item ">
                                <a class="nav-link" href="./tables/regular.html">
                                    <span class="sidebar-mini">RT</span>
                                    <span class="sidebar-normal">Regular Tables</span>
                                </a>
                            </li>
                            <li class="nav-item ">
                                <a class="nav-link" href="./tables/extended.html">
                                    <span class="sidebar-mini">ET</span>
                                    <span class="sidebar-normal">Extended Tables</span>
                                </a>
                            </li>
                            <li class="nav-item ">
                                <a class="nav-link" href="./tables/bootstrap-table.html">
                                    <span class="sidebar-mini">BT</span>
                                    <span class="sidebar-normal">Bootstrap Table</span>
                                </a>
                            </li>
                            <li class="nav-item ">
                                <a class="nav-link" href="./tables/datatables.net.html">
                                    <span class="sidebar-mini">DT</span>
                                    <span class="sidebar-normal">DataTables.net</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="collapse" href="#mapsExamples">
                        <i class="fa-solid fa-store"></i>
                        <p>
                            Shop
                            <b class="caret"></b>
                        </p>
                    </a>
                    <div class="collapse " id="mapsExamples">
                        <ul class="nav">
                            <li class="nav-item ">
                                <a class="nav-link" href="{% url 'post_list' %}">
                                    <span class="sidebar-mini">PL</span>
                                    <span class="sidebar-normal">Product List</span>
                                </a>
                            </li>
                            <li class="nav-item ">
                                <a class="nav-link" href="./maps/vector.html">
                                    <span class="sidebar-mini">VM</span>
                                    <span class="sidebar-normal">Vector maps</span>
                                </a>
                            </li>
                            <li class="nav-item ">
                                <a class="nav-link" href="./maps/fullscreen.html">
                                    <span class="sidebar-mini">FSM</span>
                                    <span class="sidebar-normal">Full Screen Map</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                {% if user.is_authenticated %}

                <li class="nav-item ">
                    <a class="nav-link" href="{% url 'view_profile' user.username %}">
                        <i class="fa-solid fa-user"></i>
                        <p>@{{user.username}}</p>
                    </a>
                </li>
                {% endif %}
                <li class="nav-item text-center">
                <a href="#" title=""  data-toggle="modal" data-target="#StoryModal" class="btn btn-light ">
                   
                    <b >POST</b>
                  </a>
                  </li>
            </ul>

      
        </div>
   </div>
   <div class="main-panel">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg ">
                <div class="container-fluid">
                    <div class="navbar-wrapper">
                        <div class="navbar-minimize">
                            <button id="minimizeSidebar" class="btn bg-light text-dark btn-fill btn-round btn-icon d-none d-lg-block">
                                <i class="fa fa-chevron-left visible-on-sidebar-regular"></i>
                                <i class="fa fa-chevron-right visible-on-sidebar-mini"></i>
                            </button>
                        </div>
                        <a class="navbar-brand" href=""> <img src="{% static 'img/soconium.png' %}" alt="">  </a>
                    </div>
                    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-end">
                        <ul class="nav navbar-nav mr-auto">
                            <form class="navbar-form navbar-left navbar-search-form" role="search">
                                <div class="input-group">
                                    <i class="nc-icon nc-zoom-split"></i>
                                    <input type="text" value="" class="form-control" placeholder="Search...">
                                </div>
                            </form>
                        </ul>
                        <ul class="navbar-nav">
                            <li class="dropdown nav-item">
                                <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                                    <i class="nc-icon nc-planet"></i>
                                </a>
                                <ul class="dropdown-menu">
                                    <a class="dropdown-item" href="#">Create New Post</a>
                                    <a class="dropdown-item" href="#">Manage Something</a>
                                    <a class="dropdown-item" href="#">Do Nothing</a>
                                    <a class="dropdown-item" href="#">Submit to live</a>
                                    <li class="divider"></li>
                                    <a class="dropdown-item" href="#">Another action</a>
                                </ul>
                            </li>
                            <li class="dropdown nav-item">
                                <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                                    <i class="nc-icon nc-bell-55"></i>
                                    <span class="notification">5</span>
                                    <span class="d-lg-none">Notification</span>
                                </a>
                                <ul class="dropdown-menu">
                                    <a class="dropdown-item" href="#">Notification 1</a>
                                    <a class="dropdown-item" href="#">Notification 2</a>
                                    <a class="dropdown-item" href="#">Notification 3</a>
                                    <a class="dropdown-item" href="#">Notification 4</a>
                                    <a class="dropdown-item" href="#">Notification 5</a>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="https://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="nc-icon nc-bullet-list-67"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                                    <a class="dropdown-item" href="#">
                                        <i class="nc-icon nc-email-85"></i> Messages
                                    </a>
                                    <a class="dropdown-item" href="#">
                                        <i class="nc-icon nc-umbrella-13"></i> Help Center
                                    </a>
                                    <a class="dropdown-item" href="#">
                                        <i class="nc-icon nc-settings-90"></i> Settings
                                    </a>
                                    <div class="divider"></div>
                                    <a class="dropdown-item" href="#">
                                        <i class="nc-icon nc-lock-circle-open"></i> Lock Screen
                                    </a>
                                    <a href="#" class="dropdown-item text-danger">
                                        <i class="nc-icon nc-button-power"></i> Log out
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- End Navbar -->

   {% block content %}
   {% endblock %}
   <footer class="footer">
    <div class="container">
        <nav>
            <ul class="footer-menu">
                <li>
                    <a href="#">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">
                        Company
                    </a>
                </li>
                <li>
                    <a href="#">
                        Portfolio
                    </a>
                </li>
                <li>
                    <a href="#">
                        Blog
                    </a>
                </li>
            </ul>
            <p class="copyright text-center">
                ©
                <script>
                    document.write(new Date().getFullYear())
                </script>

                Soconey
            </p>
        </nav>
    </div>
</footer>
   </div>
   </div>

</body>


<div class="modal fade" id="StoryModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close "data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true" >&times;</span>
          </button>
        </div>
  
            <div class="container">
              <div class="modal-body">
              <ul class="form-tabs-bar  text-center">
                <li id="tab1" class="form-tab form-tab-active btn btn-light btn-round "><i class="fa-solid fa-store"></i> </li>
                <li id="tab2" class="form-tab btn btn-light btn-round "> <i class="fa-solid fa-hashtag "></i> </li>
  
              </ul>
  
              
  
              <div class="form-content-container mt-4 ">
                <div class="form-content form-content-tab1 form-content-active">
  
                    <form method="post" enctype="multipart/form-data" class="post_form" id="product-form" accept-charset="UTF-8" action="{% url 'upload_product' %}" method="POST">
                        {% csrf_token %}
                        <div class="form-group mt-3 topic">
                            {{ form.headline }}
                        </div>
                        <div class="form-group ml-2 topic ">
                           Category: {{ form.category }}
                          </div>
                          <div class="form-group ml-2 topic ">
                            {{ form.size }}
                          </div>
                          <div class="form-group ml-2 topic ">
                            {{ form.max_price }}
                          </div>
                    
                    
                        
                        <textarea type="text" name="body" class="form-control post-input"  placeholder="Your Post goes here ..." style="height: 180px;" ></textarea>
                    
                    
                    <div class="word-count-progress ml-2 mr-2 mt-2 ">
                    <div class="progress">
                        <div class="progress-bar bg-light" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <p class="text-center mt-3"><span class="character-count grey">0/360</span></p>
                    </div>
                    <div class="col-12  ">
                        <div class="row">
                        
                        <div class="form-group">
                        <input type="file" id="id_sell_image" name="{{ form.image.name }}" class="file-input">
                    
                    </div>                       
                      </div>
                    
                      <div class="sell-thumbnail-container">
                        <button class=" btn btn-light  clear-sell-image-button" type="button"><i class="fa-solid fa-times"></i></button>
                        <img id="sell_thumbnail" src="" alt="Thumbnail" style="max-width: 100%; height: 144px; ">
                    
                    </div>
                    
                      </div>
                      <div id="uploaded_files"></div>
                     <div class="alert alert-danger resmessage" style="display:none;"></div>
                     <div class="row">
                      <div class="mr-auto mt-2 ml-3">
                        <label for="id_sell_image" class="file-label">
                          <span class="icon">
                            <img src="{% static 'img/icons/image.png'%}" alt="">
                          </span> 
                      </label>
                      </div>
                     <div class="ml-auto mt-3 mr-3">
                      <button type="submit" name="submit" class="btn btn-danger btn-round px-4 btnClick ">Publish</button>
                    </div>
                    </div>
                </form>
  
                </div>
              </div>
  
              <div class="form-content-container ">
                <div class="form-content form-content-tab2 ">
                    <p class="text-center mt-2">New tag</p>
                    <form method="post" enctype="multipart/form-data" class="post_form" id="tag-form" accept-charset="UTF-8" action="{% url 'upload_tag' %}" method="POST">
                        {% csrf_token %}
                       
                        <div class="form-group ml-2 topic ">
                           Category: {{ tag_form.category }}
                          </div>

                          <div class="form-group mt-3 topic">
                            {{ tag_form.name }}
                        </div>
            
                          <button type="submit" name="submit" class="btn btn-danger btn-round px-4 btnClick mt-2 ">Publish</button>

                </form>
                        
                       
                  
                </div>
  
  
              </div>
  
           
                  </div>
                  </div>
  
        <div class="modal-footer">
         
        </div>
    </div>
  </div>
  </div>

  <div class="modal fade" id="successModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content post-success" >
          <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"> 
            <span aria-hidden="true">&times;</span>
        </button>
      </div>
            <div class="modal-body mb-3">
                <p id="successMessage" class="text-center">Your post was successful. </p>
  
            </div>
           
        </div>
    </div>
  </div>
{% block scripts %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="{% static 'js/popper.min.js'%}"></script>

<script src="{% static 'js/bootstrap.min.js'%}"></script>
<script src="{% static 'js/progress.js'%}"></script>

<script src="{% static 'js/dashboard.js'%}"></script>
<script src="{% static 'js/reports.js'%}"></script>

<script src="{% static 'js/charts/userschart.js'%}"></script>
<script src="{% static 'js/app_scripts.js'%}"></script>
<script src="{% static 'js/votes.js'%}"></script>
<script src="{% static 'js/comment.js'%}"></script>

  <script src="{% static 'js/comment_votes.js'%}"></script>

<script>

$('#product-form').submit(function(event) {
        event.preventDefault();

        var formData = new FormData(this);
        var csrfToken = $('input[name=csrfmiddlewaretoken]').val();

        var imageInput = $('#id_sell_image')[0]; // Replace 'id_post_image' with the actual ID of the image input

// Check if an image was selected
        if (imageInput.files.length > 0) {
    // Append the selected file to formData
    formData.append('post_image', imageInput.files[0]);
      }

        var modal = $('#StoryModal'); 
        var successModal = $('#successModal'); // Your success modal ID

        $.ajaxSetup({
            headers: {
                'X-CSRFToken': csrfToken
            }
        });

        $.ajax({
            url: '{% url "upload_product" %}',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                if (response.success) {
                    modal.modal('hide');
                    $('#product-form')[0].reset();
                    // Show the success modal
                    successModal.modal('show');
                    // Update the success message in the modal
                    $('#successMessage').text(response.message);
                    // Close the success modal after a certain delay (e.g., 3 seconds)
                    setTimeout(function() {
                        successModal.modal('hide');
                    }, 3000); // 3000 milliseconds (3 seconds)
                } else {
                    alert(response.message);
                }
            },
            error: function() {
                alert('An error occurred while submitting the form.');
            }
        });
    }); 


$('#tag-form').submit(function(event) {
        event.preventDefault();

        var formData = new FormData(this);
        var csrfToken = $('input[name=csrfmiddlewaretoken]').val();


        var modal = $('#StoryModal'); 
        var successModal = $('#successModal'); // Your success modal ID

        $.ajaxSetup({
            headers: {
                'X-CSRFToken': csrfToken
            }
        });

        $.ajax({
            url: '{% url "upload_tag" %}',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                if (response.success) {
                    modal.modal('hide');
                    $('#tag-form')[0].reset();
                    // Show the success modal
                    successModal.modal('show');
                    // Update the success message in the modal
                    $('#successMessage').text(response.message);
                    // Close the success modal after a certain delay (e.g., 3 seconds)
                    setTimeout(function() {
                        successModal.modal('hide');
                    }, 3000); // 3000 milliseconds (3 seconds)
                } else {
                    alert(response.message);
                }
            },
            error: function() {
                alert('An error occurred while submitting the form.');
            }
        });
    }); 

    $(document).ready(function() {
    // Function to get the CSRF token from the cookie
    function getCSRFToken() {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.substring(0, 'csrftoken'.length + 1) === 'csrftoken=') {
                    cookieValue = decodeURIComponent(cookie.substring('csrftoken='.length));
                    break;
                }
            }
        }
        return cookieValue;
    }

    $('#ProductEditModal').on('submit', function(e) {
        e.preventDefault(); // Prevent the default form submission

        // var formData = $(this).serialize();
        var formData = new FormData();

        // Log the serialized form data to the console for debugging
        console.log(formData);

        // Append other profile information
        formData.append('id', $('#post_id').val());   
        formData.append('headline', $('#id_headline').val());
        formData.append('size', $('#id_size').val());
        formData.append('max_price', $('#id_max_price').val());

        formData.append('category', $('#id_category').val());
        formData.append('body', $('#id_body').val());

        // Get the CSRF token
        var csrfToken = getCSRFToken();

        if (csrfToken) {
            // Add the CSRF token as a header
            $.ajaxSetup({
                headers: {
                    'X-CSRFToken': csrfToken
                }
            });

            $.ajax({
                type: 'POST',
                url: '/update_post/', // Replace with your actual URL for profile update
                data: formData,
                processData: false,
                contentType: false,
                success: function(data) {
                    // Handle the success response
                    displayMessage('Success', 'Post updated successfully');
                    setTimeout(function() {
                        location.reload();
                    }, 2000); // Reload the page after 2 seconds
                },
                error: function(xhr, status, error) {
                    // Handle the error response
                    displayMessage('Error', 'Post update failed. Please check the form.');
                }
            });
        }
    });

    function displayMessage(title, message) {
        // Set the title and message in the modal
        $('#messageModalLabel').text(title);
        $('#messageText').text(message);

        // Show the modal
        $('#messageModal').modal('show');

        // Automatically close the modal after 2 seconds
        setTimeout(function() {
            $('#messageModal').modal('hide');
        }, 2000);
    }
})

</script>

{%endblock%}
  </html>